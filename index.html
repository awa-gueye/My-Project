
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syst√®me de Gestion d'√âlections ENSAE</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --academic-blue: #1e40af;
            --primary: #1e40af;
            --secondary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* √âcran de connexion */
        .login-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(rgba(30, 64, 175, 0.6), rgba(30, 64, 175, 0.6)),
                        url('https://raw.githubusercontent.com/Salla06/TP2/main/ANSD.png');
            background-size: cover;
            background-position: center;
            padding: 2rem;
        }        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            padding: 2rem;
            max-width: 400px;
            width: 100%;
        }
        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: var(--white);
            font-size: 2rem;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        label {
            display: block;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            border: none;
            text-decoration: none;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover:not(:disabled) {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-50);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover:not(:disabled) {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }

        .btn-warning:hover:not(:disabled) {
            background: #d97706;
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1rem;
        }
        /* Presentation*/
        .page-section {
            padding: 3rem 1.5rem;
            background-color: var(--gray-50);
            text-align: center;
        }

        .section-header h2 {
            font-size: 2rem;
            color: var(--academic-blue);
            margin-bottom: 1rem;
        }

        .section-header p {
            font-size: 1rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto;
        }

        .ensae-image {
            margin-top: 2rem;
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
        }

        .footer {
            background: var(--gray-100);
            text-align: center;
            padding: 1rem 0;
            color: var(--gray-500);
            font-size: 0.875rem;
            margin-top: 3rem;
        }

        /* Page de vote */
        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .candidate-card {
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--white);
        }

        .candidate-card:hover {
            border-color: var(--academic-blue);
            background: #f0f9ff;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .candidate-card.selected {
            border-color: var(--academic-blue);
            background: #f0f9ff;
            box-shadow: var(--shadow-md);
        }

        .candidate-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .candidate-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .candidate-radio {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--academic-blue);
        }

        .candidate-image {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            object-fit: cover;
        }

        .candidate-info h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .candidate-program {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .candidate-description {
            color: var(--gray-500);
            font-size: 0.75rem;
        }

        .vote-actions {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--gray-200);
        }

        .vote-btn {
            width: 100%;
            max-width: 400px;
            padding: 1rem 2rem;
            font-size: 1.125rem;
        }
/* Hero Section */
        .hero-section {
            background-image: linear-gradient(rgba(30, 64, 175, 0.7), rgba(30, 64, 175, 0.7)), 
                              url('https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080');
            background-size: cover;
            background-position: center;
            height: 24rem;
            border-radius: var(--border-radius-xl);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content {
            text-align: center;
            color: var(--white);
            animation: fadeIn 0.8s ease-in-out;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hero-subtitle {
            font-size: 1.25rem;
            font-weight: 300;
            margin-bottom: 2rem;
            max-width: 600px;
        }



        .hero-btn {
            background: var(--white);
            color: var(--academic-blue);
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
        }


        .hero-btn:hover {
            background: var(--gray-100);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Application principale */
        .app-container {
            display: none;
        }

        .app-container.active {
            display: block;
        }

        .navbar {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 4rem;
        }

        .nav-title {
            color: var(--primary);
            font-size: 1.25rem;
            font-weight: 700;
            cursor: pointer;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: var(--gray-500);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-link:hover {
            color: var(--gray-700);
            background: var(--gray-50);
        }

        .nav-link.active {
            color: var(--primary);
            background: #dbeafe;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .main-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-container {
            background: var(--white);
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 2rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .page-description {
            color: var(--gray-600);
            font-size: 1rem;
        }

        /* Page d'accueil */
        .welcome-section {
            text-align: center;
            padding: 3rem 0;
        }

        .welcome-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 2rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .welcome-message {
            font-size: 1.5rem;
            color: var(--gray-700);
            margin-bottom: 2rem;
        }

        .welcome-description {
            font-size: 1.125rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto 3rem;
            line-height: 1.7;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
        }

        .stat-icon.primary { background: var(--primary); }
        .stat-icon.success { background: var(--success); }
        .stat-icon.secondary { background: var(--secondary); }
        .stat-icon.warning { background: var(--warning); }

        .stat-label {
            color: var(--gray-500);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .elections-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .election-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .election-info h3 {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .election-status {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        .status-active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-draft {
            background: #fef3c7;
            color: #92400e;
        }

        .status-closed {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-inactive {
            background: #f3f4f6;
            color: #374151;
        }

        .election-dates {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .election-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .file-upload {
            border: 2px dashed var(--gray-300);
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: #f0f9ff;
        }

        .file-upload.dragover {
            border-color: var(--primary);
            background: #f0f9ff;
        }

        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .candidate-card {
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--white);
        }

        .candidate-card:hover {
            border-color: var(--primary);
            background: #f0f9ff;
        }

        .candidate-card.selected {
            border-color: var(--primary);
            background: #f0f9ff;
        }

        .candidate-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .candidate-image {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            object-fit: cover;
        }

        .vote-section {
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .vote-section h4 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .blank-vote-option {
            border: 2px dashed var(--gray-300);
            padding: 2rem;
            text-align: center;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: #f9fafb;
            margin-top: 1rem;
        }

        .blank-vote-option:hover {
            border-color: var(--warning);
            background: #fef3c7;
        }

        .blank-vote-option.selected {
            border-color: var(--warning);
            background: #fef3c7;
            color: var(--warning);
        }

        .results-chart {
            margin-bottom: 2rem;
        }

        .result-bar {
            margin-bottom: 1rem;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .result-progress {
            width: 100%;
            height: 0.75rem;
            background: var(--gray-200);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .result-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 0.5rem;
        }

        .result-fill.first { background: var(--success); }
        .result-fill.second { background: var(--primary); }
        .result-fill.third { background: var(--secondary); }
        .result-fill.other { background: var(--gray-400); }

        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            padding: 1rem;
            min-width: 300px;
            z-index: 3000;
            animation: slideIn 0.3s ease;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .admin-tab {
            display: none;
        }

        .admin-tab.active {
            display: block;
        }

        .positions-selector {
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .position-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .position-item input[type="checkbox"] {
            width: auto;
        }

        .image-upload-container {
            position: relative;
            display: inline-block;
        }

        .image-upload-btn {
            background: var(--gray-100);
            border: 2px dashed var(--gray-300);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }

        .image-upload-btn:hover {
            border-color: var(--primary);
            background: #f0f9ff;
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert-warning {
            background: #fef3c7;
            border: 1px solid var(--warning);
            color: #92400e;
        }

        .alert-success {
            background: #d1fae5;
            border: 1px solid var(--success);
            color: #065f46;
        }

        .error-message {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .card {
        background: var(--white);
        border-radius: 1rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 2rem;
        margin-bottom: 2rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .card-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .profile-section {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .profile-photo {
            flex: 0 0 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .photo-placeholder {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--gray-500);
        }

        .profile-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .info-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .info-group label {
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .info-group p {
            font-size: 0.95rem;
            color: var(--gray-800);
        }

        .edit-mode-only {
            display: none;
        }

        .view-mode {
            display: block;
        }


        @media (max-width: 768px) {
            .nav-menu { gap: 1rem; }
            .main-content { padding: 1rem; }
            .form-row { grid-template-columns: 1fr; }
            .modal-content { width: 95%; margin: 1rem; }
            .election-actions { flex-direction: column; }
            .welcome-title { font-size: 2rem; }
            .welcome-message { font-size: 1.25rem; }
        }
 </style>
</head>
<body>

    <!-- √âcran de connexion -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-vote-yea"></i>
                </div>
                <h1 class="login-title">√âlections ENSAE</h1>
                <p class="login-subtitle">Connectez-vous pour acc√©der au syst√®me</p>
            </div>
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required placeholder="votre.email@ensae.fr">
                </div>
                <div class="form-group">
                    <label for="password">Mot de passe</label>
                    <input type="password" id="password" required placeholder="Votre mot de passe">
                </div>
                <div id="login-error" class="error-message" style="display: none;"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    <i class="fas fa-sign-in-alt"></i>
                    Se connecter
                </button>
            </form>
        </div>
    </div>

    <!-- Application principale -->
    <div id="app" class="app-container">
        <nav class="navbar">
            <div class="nav-container">
                <h1 class="nav-title" onclick="navigateTo('home')">√âlections ENSAE</h1>
                <div class="nav-menu">
                    <button class="nav-link active" onclick="navigateTo('home')">
                        <i class="fas fa-home"></i> Accueil
                    </button>
                    <button class="nav-link" onclick="navigateTo('elections')">
                        <i class="fas fa-vote-yea"></i> √âlections
                    </button>
                    <button class="nav-link" onclick="navigateTo('results')" id="results-nav">
                        <i class="fas fa-chart-bar"></i> R√©sultats
                    </button>
                    <button class="nav-link" onclick="navigateTo('admin')" id="admin-nav">
                        <i class="fas fa-cog"></i> Administration
                    </button>
                </div>
                <div class="nav-user">
                    <button class="nav-link" onclick="navigateTo('profile')">
                        <i class="fas fa-user-graduate"></i> Compte √âtudiant
                    </button>
                    <button class="nav-link btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> D√©connexion
                    </button>
                </div>
            </div>
        </nav>

        <main class="main-content">
           <!-- Page d'accueil -->
            <div id="home-page" class="page active">
              <!-- Hero Section -->
                <div class="hero-section">
                    <div class="hero-content">
                      <h1 class="hero-title">√âlections ENSAE 2024</h1>
                      <p class="hero-subtitle">Syst√®me de gestion des √©lections de l'amicale des √©l√®ves et stagiaires</p>
                      <button class="hero-btn" onclick="navigateTo('elections')">
                          <i class="fas fa-vote-yea"></i>
                          Commencer √† voter
                      </button>
                    </div>
                </div>
              <!-- Pr√©sentation Amicale -->
                <section id="election-info" class="page-section">
                  <div class="section-header">
                      <h2>√âlections ENSAE 2024 - Syst√®me de Gestion</h2>
                      <p>Syst√®me de gestion d'√©lections pour l'amicale des √©l√®ves et stagiaires de l'ENSAE. Vote en ligne s√©curis√© et r√©sultats en temps r√©el.</p>
                  </div>
                  <div class="election-info-content">
                      <img src="https://www.ensae.sn/sites/default/files/styles/large/public/2022-08/WhatsApp%20Image%202022-08-29%20at%2013.28.40%20%285%29.jpeg?itok=1EKt0U9D" alt="Image de l'ENSAE" class="ensae-image">
                  </div>
                </section>
                <footer class="footer">
                  <p>&copy; 2025 AES ENSAE - Tous droits r√©serv√©s.</p>
                </footer>       
            </div>
            <!-- Page des r√©sultats -->
            <div id="results-page" class="page">
                <div class="page-container">
                    <div class="page-header">
                        <div>
                            <h2 class="page-title">R√©sultats</h2>
                            <p class="page-description">R√©sultats en temps r√©el</p>
                        </div>
                        <button class="btn btn-success" onclick="exportResults()">
                            <i class="fas fa-download"></i> Exporter
                        </button>
                    </div>

                    <div id="results-content"></div>
                </div>
                <div class="page-container">
                    <div class="page-header">
                        <div>
                            <h2 class="page-title">Tableau de bord</h2>
                            <p class="page-description">Vue d'ensemble du syst√®me d'√©lections</p>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon primary">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <p class="stat-label">√âtudiants inscrits</p>
                                <p class="stat-value" id="total-students">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon success">
                                <i class="fas fa-vote-yea"></i>
                            </div>
                            <div>
                                <p class="stat-label">Votes exprim√©s</p>
                                <p class="stat-value" id="total-votes">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon secondary">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div>
                                <p class="stat-label">Taux de participation</p>
                                <p class="stat-value" id="participation-rate">0%</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon warning">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div>
                                <p class="stat-label">√âlections actives</p>
                                <p class="stat-value" id="active-elections">0</p>
                            </div>
                        </div>
                    </div>

                    <div id="active-elections-list">
                        <h3 style="margin-bottom: 1rem;">√âlections en cours</h3>
                        <div id="dashboard-elections"></div>
                    </div>
                </div>
            </div>
            
            <!-- Page des √©lections -->
            <div id="elections-page" class="page">
                <div class="page-container">
                    <div class="page-header">
                        <div>
                            <h2 class="page-title">√âlections</h2>
                            <p class="page-description">Participez aux diff√©rentes √©lections</p>
                        </div>
                    </div>

                    <div id="elections-list"></div>
                </div>
            </div>


            <!-- Page d'administration -->
            <div id="admin-page" class="page">
                <div class="page-container">
                    <div class="page-header">
                        <div>
                            <h2 class="page-title">Administration</h2>
                            <p class="page-description">G√©rer le syst√®me d'√©lections</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="openImportModal()">
                                <i class="fas fa-upload"></i> Importer donn√©es
                            </button>
                            <button class="btn btn-primary" onclick="openElectionModal()">
                                <i class="fas fa-plus"></i> Nouvelle √©lection
                            </button>
                        </div>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <button class="btn btn-primary" onclick="switchAdminTab('elections')" id="elections-tab-btn">
                            √âlections
                        </button>
                        <button class="btn btn-secondary" onclick="switchAdminTab('candidates')" id="candidates-tab-btn">
                            Candidats
                        </button>
                        <button class="btn btn-secondary" onclick="switchAdminTab('voters')" id="voters-tab-btn">
                            √âlecteurs
                        </button>
                    </div>

                    <div id="admin-elections" class="admin-tab active"></div>
                    <div id="admin-candidates" class="admin-tab"></div>
                    <div id="admin-voters" class="admin-tab"></div>
                </div>
            </div>
            <!--Compte Etudient-->
            <div id="profile-page" class="page">
                <div class="page-header">
                    <h2 class="page-title">üë§ Compte √âtudiant</h2>
                    <p class="page-subtitle">G√©rez vos informations personnelles et votre statut √©lectoral</p>
                </div>
                
                <!-- Informations personnelles -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üë§ Informations personnelles</h3>
                        <button class="btn btn-secondary" onclick="toggleEditMode()" id="edit-profile-btn">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="profile-section">
                            <div class="profile-photo">
                                <div class="photo-placeholder" id="profile-photo">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="edit-mode-only" style="display: none; margin-top: 0.5rem;">
                                    <input type="text" id="photo-url" placeholder="URL de la photo de profil" style="font-size: 0.875rem;">
                                </div>
                            </div>
                            
                            <div class="profile-info">
                                <div class="info-group">
                                    <label>Nom complet</label>
                                    <p id="display-name">-</p>
                                </div>
                                
                                <div class="info-group">
                                    <label>Email institutionnel</label>
                                    <p id="display-email">-</p>
                                </div>
                                
                                <div class="info-group">
                                    <label>Num√©ro de carte / Matricule ENSAE</label>
                                    <p id="display-matricule" class="view-mode">-</p>
                                    <input type="text" id="edit-matricule" class="edit-mode-only" style="display: none;" placeholder="Votre matricule ENSAE">
                                </div>
                                
                                <div class="info-group">
                                    <label>Promotion</label>
                                    <p id="display-promotion" class="view-mode">-</p>
                                    <input type="text" id="edit-promotion" class="edit-mode-only" style="display: none;" placeholder="Ex: 2024-2026">
                                </div>
                                
                                <div class="info-group">
                                    <label>Sp√©cialit√©</label>
                                    <p id="display-specialite" class="view-mode">-</p>
                                    <select id="edit-specialite" class="edit-mode-only" style="display: none;">
                                        <option value="">S√©lectionner une sp√©cialit√©</option>
                                        <option value="ISE">ISE - Ing√©nieur Statisticien √âconomiste</option>
                                        <option value="AS">AS - Attach√© de Statistique</option>
                                        <option value="ISEP">ISEP - Ing√©nieur des Travaux Statistiques</option>
                                        <option value="AUTRE">Autre</option>
                                    </select>
                                </div>
                                
                                <div class="edit-mode-only" style="display: none; margin-top: 1rem;">
                                    <button class="btn btn-success" onclick="saveProfile()">
                                        <i class="fas fa-save"></i> Sauvegarder
                                    </button>
                                    <button class="btn btn-secondary" onclick="cancelEdit()">
                                        <i class="fas fa-times"></i> Annuler
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals (identiques au code pr√©c√©dent) -->
    <div id="election-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="election-modal-title">Cr√©er une √©lection</h3>
                <button onclick="closeModal('election-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="election-form">
                    <input type="hidden" id="edit-election-id">
                    <div class="form-group">
                        <label>Titre de l'√©lection</label>
                        <input type="text" id="election-title" required>
                    </div>
                    <div class="form-group">
                        <label>Postes √©lectifs</label>
                        <div class="positions-selector">
                            <div class="position-item">
                                <input type="checkbox" id="pos-president" value="president">
                                <label for="pos-president">Pr√©sident</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-vice-president" value="vice-president">
                                <label for="pos-vice-president">Vice-Pr√©sident</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-secretaire" value="secretaire">
                                <label for="pos-secretaire">Secr√©taire</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-tresorier" value="tresorier">
                                <label for="pos-tresorier">Tr√©sorier</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-responsable-communication" value="responsable-communication">
                                <label for="pos-responsable-communication">Responsable Communication</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-responsable-evenements" value="responsable-evenements">
                                <label for="pos-responsable-evenements">Responsable √âv√©nements</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-responsable-sports" value="responsable-sports">
                                <label for="pos-responsable-sports">Responsable Sports</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-representant-m1" value="representant-m1">
                                <label for="pos-representant-m1">Repr√©sentant M1</label>
                            </div>
                            <div class="position-item">
                                <input type="checkbox" id="pos-representant-m2" value="representant-m2">
                                <label for="pos-representant-m2">Repr√©sentant M2</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="election-description"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date de d√©but</label>
                            <input type="datetime-local" id="election-start" required>
                        </div>
                        <div class="form-group">
                            <label>Date de fin</label>
                            <input type="datetime-local" id="election-end" required>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('election-modal')">
                            Annuler
                        </button>
                        <button type="submit" class="btn btn-primary" id="election-submit-btn">
                            Cr√©er
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="candidate-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="candidate-modal-title">Ajouter un candidat</h3>
                <button onclick="closeModal('candidate-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="candidate-form">
                    <input type="hidden" id="edit-candidate-id">
                    <div class="form-group">
                        <label>√âlection</label>
                        <select id="candidate-election" required>
                            <option value="">S√©lectionner une √©lection</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Poste</label>
                        <select id="candidate-position" required>
                            <option value="">S√©lectionner un poste</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nom du candidat</label>
                        <input type="text" id="candidate-name" required>
                    </div>
                    <div class="form-group">
                        <label>Programme d'√©tudes</label>
                        <input type="text" id="candidate-program" required>
                    </div>
                    <div class="form-group">
                        <label>Description/Programme √©lectoral</label>
                        <textarea id="candidate-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Image du candidat</label>
                        <div class="image-upload-container">
                            <div class="image-upload-btn" onclick="document.getElementById('candidate-image-file').click()">
                                <i class="fas fa-camera"></i>
                                <p>Choisir une image locale ou utiliser une URL</p>
                                <img id="candidate-image-preview" style="max-width: 100px; max-height: 100px; display: none; margin-top: 0.5rem;">
                            </div>
                            <input type="file" id="candidate-image-file" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                        </div>
                        <input type="url" id="candidate-image" placeholder="https://example.com/image.jpg" style="margin-top: 0.5rem;">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('candidate-modal')">
                            Annuler
                        </button>
                        <button type="submit" class="btn btn-primary" id="candidate-submit-btn">
                            Ajouter
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="vote-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="vote-modal-title">Voter</h3>
                <button onclick="closeModal('vote-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="vote-modal-content"></div>
            </div>
        </div>
    </div>

    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Importer des donn√©es</h3>
                <button onclick="closeModal('import-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Type de donn√©es</label>
                    <select id="import-type">
                        <option value="voters">Liste des √©lecteurs</option>
                        <option value="candidates">Liste des candidats</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fichier Excel</label>
                    <div class="file-upload" id="file-upload-area">
                        <i class="fas fa-upload" style="font-size: 2rem; color: var(--gray-400); margin-bottom: 1rem;"></i>
                        <p>Glissez-d√©posez votre fichier Excel ici ou cliquez pour s√©lectionner</p>
                        <input type="file" id="excel-file" accept=".xlsx,.xls" style="display: none;">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('import-modal')">
                        Annuler
                    </button>
                    <button type="button" class="btn btn-primary" onclick="processImport()">
                        Importer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // √âtat global de l'application avec authentification
        const appState = {
            elections: [],
            candidates: [],
            voters: [],
            votes: [],
            currentUser: null,
            editingElection: null,
            editingCandidate: null,
            isAuthenticated: false,
            isAdmin: false,
            settings: {
                autoCalculateStats: true,
                realTimeResults: true
            }
        };

        // Identifiants administrateur
        const ADMIN_CREDENTIALS = {
            email: 'admin@ensae.fr',
            password: 'admin123'
        };

        // Positions disponibles
        const positions = {
            'president': 'Pr√©sident',
            'vice-president': 'Vice-Pr√©sident',
            'secretaire': 'Secr√©taire',
            'tresorier': 'Tr√©sorier',
            'responsable-communication': 'Responsable Communication',
            'responsable-evenements': 'Responsable √âv√©nements',
            'responsable-sports': 'Responsable Sports',
            'representant-m1': 'Repr√©sentant M1',
            'representant-m2': 'Repr√©sentant M2'
        };

        // Initialisation
        function initApp() {
            loadData();
            setupEventListeners();
            
            // V√©rifier si l'utilisateur est d√©j√† connect√©
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                appState.currentUser = JSON.parse(savedUser);
                appState.isAuthenticated = true;
                appState.isAdmin = appState.currentUser.email === ADMIN_CREDENTIALS.email;
                showApp();
            } else {
                showLogin();
            }
            
            // Auto-mise √† jour des statistiques et v√©rification des √©lections expir√©es
            if (appState.settings.autoCalculateStats) {
                setInterval(() => {
                    checkElectionDeadlines();
                    updateStats();
                }, 30000);
            }
            
            checkElectionDeadlines();
        }

        // Gestion de l'authentification
        function showLogin() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app').classList.remove('active');
        }

        function showApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').classList.add('active');
            
            // Configurer l'interface selon le type d'utilisateur
            setupUserInterface();
            navigateTo('home');
        }

        function setupUserInterface() {
            const userWelcome = document.getElementById('user-welcome');
            const personalWelcome = document.getElementById('personal-welcome');
            const dashboardNav = document.getElementById('dashboard-nav');
            const resultsNav = document.getElementById('results-nav');
            const adminNav = document.getElementById('admin-nav');

            if (appState.currentUser) {
                const fullName = `${appState.currentUser.prenom || ''} ${appState.currentUser.nom || ''}`.trim() || appState.currentUser.email;
                userWelcome.textContent = fullName;
                personalWelcome.textContent = `Bienvenue ${appState.currentUser.prenom || 'cher √©tudiant'}${appState.currentUser.nom ? ' ' + appState.currentUser.nom : ''}`;
                
                // Afficher le tableau de bord pour tous les utilisateurs connect√©s
                dashboardNav.style.display = 'flex';
                
                if (appState.isAdmin) {
                    // Administrateur : acc√®s complet
                    resultsNav.style.display = 'flex';
                    adminNav.style.display = 'flex';
                } else {
                    // √âtudiant : pas d'acc√®s admin/r√©sultats
                    resultsNav.style.display = 'none';
                    adminNav.style.display = 'none';
                }
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            const errorEl = document.getElementById('login-error');

            // V√©rifier si c'est l'administrateur
            if (email === ADMIN_CREDENTIALS.email && password === ADMIN_CREDENTIALS.password) {
                appState.currentUser = {
                    email: email,
                    prenom: 'Administrateur',
                    nom: 'Syst√®me',
                    classe: 'Admin'
                };
                appState.isAuthenticated = true;
                appState.isAdmin = true;
                
                localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                showApp();
                return;
            }

            // V√©rifier dans la base des √©lecteurs
            const voter = appState.voters.find(v => 
                v.email && v.email.toLowerCase() === email && v.password === password
            );

            if (voter) {
                appState.currentUser = {
                    id: voter.id,
                    email: voter.email,
                    prenom: voter.prenom || voter.name?.split(' ')[0] || '',
                    nom: voter.nom || voter.name?.split(' ').slice(1).join(' ') || '',
                    classe: voter.classe || voter.program || '',
                    hasVoted: voter.hasVoted || []
                };
                appState.isAuthenticated = true;
                appState.isAdmin = false;
                
                localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                showApp();
            } else {
                errorEl.textContent = 'Email ou mot de passe incorrect';
                errorEl.style.display = 'block';
            }
        }

        function logout() {
            appState.currentUser = null;
            appState.isAuthenticated = false;
            appState.isAdmin = false;
            localStorage.removeItem('currentUser');
            showLogin();
            
            // R√©initialiser les formulaires
            document.getElementById('login-form').reset();
            document.getElementById('login-error').style.display = 'none';
        }

        // Chargement et sauvegarde des donn√©es
        function loadData() {
            const savedData = localStorage.getItem('electionsData');
            if (savedData) {
                const data = JSON.parse(savedData);
                Object.assign(appState, data);
                
                appState.elections = appState.elections.map(election => ({
                    ...election,
                    startDate: new Date(election.startDate),
                    endDate: new Date(election.endDate)
                }));
            } else {
                initDefaultData();
            }
            
            updateStats();
        }

        function saveData() {
            const dataToSave = {
                elections: appState.elections,
                candidates: appState.candidates,
                voters: appState.voters,
                votes: appState.votes,
                settings: appState.settings
            };
            localStorage.setItem('electionsData', JSON.stringify(dataToSave));
        }

        function initDefaultData() {
            appState.elections = [
                {
                    id: 1,
                    title: "√âlection du Bureau Ex√©cutif de l'Amicale",
                    positions: ["president", "vice-president", "secretaire", "tresorier"],
                    description: "√âlection pour les postes du bureau ex√©cutif de l'amicale √©tudiante",
                    startDate: new Date('2024-03-15T08:00:00'),
                    endDate: new Date('2024-03-17T18:00:00'),
                    status: 'active'
                },
                {
                    id: 2,
                    title: "√âlection des Responsables",
                    positions: ["responsable-communication", "responsable-evenements", "responsable-sports"],
                    description: "√âlection pour les postes de responsables sp√©cialis√©s",
                    startDate: new Date('2024-03-18T08:00:00'),
                    endDate: new Date('2024-03-20T18:00:00'),
                    status: 'draft'
                }
            ];

            appState.candidates = [
                {
                    id: 1,
                    electionId: 1,
                    position: "president",
                    name: "Marie Dupont",
                    program: "Master 2 - √âconomie",
                    description: "Programme ax√© sur l'innovation et la digitalisation de l'amicale",
                    image: "https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face"
                },
                {
                    id: 2,
                    electionId: 1,
                    position: "president",
                    name: "Thomas Martin",
                    program: "Master 1 - Statistiques",
                    description: "Engagement pour l'environnement et la durabilit√©",
                    image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face"
                }
            ];

            appState.voters = [
                { 
                    id: 1, 
                    email: "test@ensae.fr", 
                    password: "test123",
                    prenom: "√âtudiant",
                    nom: "Test", 
                    classe: "M1", 
                    hasVoted: [] 
                },
                { 
                    id: 2, 
                    email: "alice.dubois@ensae.fr", 
                    password: "alice123",
                    prenom: "Alice",
                    nom: "Dubois", 
                    classe: "M2", 
                    hasVoted: [] 
                }
            ];

            appState.votes = [];
            saveData();
        }

        // V√©rification automatique des √©lections expir√©es
        function checkElectionDeadlines() {
            const now = new Date();
            let hasChanges = false;

            appState.elections.forEach(election => {
                if (election.status === 'active' && new Date(election.endDate) <= now) {
                    election.status = 'closed';
                    hasChanges = true;
                    showToast('√âlection ferm√©e', `L'√©lection "${election.title}" s'est ferm√©e automatiquement`, 'warning');
                }
            });

            if (hasChanges) {
                saveData();
                updateStats();
                if (document.getElementById('admin-page').classList.contains('active')) {
                    renderAdminElections();
                }
            }
        }

        function setupEventListeners() {
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('election-form').addEventListener('submit', handleElectionSubmit);
            document.getElementById('candidate-form').addEventListener('submit', handleCandidateSubmit);

            const fileUpload = document.getElementById('file-upload-area');
            const fileInput = document.getElementById('excel-file');
            
            if (fileUpload && fileInput) {
                fileUpload.addEventListener('click', () => fileInput.click());
                fileUpload.addEventListener('dragover', handleDragOver);
                fileUpload.addEventListener('drop', handleFileDrop);
                fileInput.addEventListener('change', handleFileSelect);
            }

            document.getElementById('candidate-election').addEventListener('change', updatePositionSelect);
        }

        // Navigation
        function navigateTo(page) {
            // V√©rifier les autorisations
            if (!appState.isAuthenticated) {
                showLogin();
                return;
            }

            if ((page === 'admin' || page === 'results') && !appState.isAdmin) {
                showToast('Acc√®s refus√©', 'Vous n\'avez pas les permissions pour acc√©der √† cette section', 'error');
                return;
            }

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                if (link.onclick && link.onclick.toString().includes(`navigateTo('${page}')`)) {
                    link.classList.add('active');
                }
            });

            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            const targetPage = document.getElementById(page + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
            }
            if (page === 'profile') {
                renderProfile();
            }
            switch(page) {
                case 'home':
                    renderHome();
                    break;
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'elections':
                    renderElections();
                    break;
                case 'results':
                    renderResults();
                    break;
                case 'admin':
                    renderAdmin();
                    break;
            }
        }

        // Rendu des pages
        function renderHome() {
            updateStats();
            // Les statistiques sur la page d'accueil sont automatiquement mises √† jour
        }

        function renderDashboard() {
            updateStats();
            
            const activeElections = appState.elections.filter(e => e.status === 'active');
            const dashboard = document.getElementById('dashboard-elections');
            
            if (!dashboard) return;
            
            if (activeElections.length === 0) {
                dashboard.innerHTML = '<p style="text-align: center; margin: 2rem;">Aucune √©lection active pour le moment.</p>';
                return;
            }

            dashboard.innerHTML = activeElections.map(election => {
                const positionsText = election.positions && election.positions.length > 0 ? 
                    election.positions.map(p => positions[p]).join(', ') : 'Aucun poste d√©fini';
                const candidatesCount = appState.candidates.filter(c => c.electionId === election.id).length;
                const votesCount = appState.votes.filter(v => v.electionId === election.id).length;
                
                return `
                    <div class="election-card">
                        <div class="election-info">
                            <h3>${election.title}</h3>
                            <p><strong>Postes:</strong> ${positionsText}</p>
                            <p>${candidatesCount} candidat(s) - ${votesCount} vote(s)</p>
                            <span class="election-status status-${election.status}">${getStatusText(election.status)}</span>
                            <div class="election-dates">
                                ${formatDate(election.startDate)} - ${formatDate(election.endDate)}
                            </div>
                        </div>
                        <div class="election-actions">
                            <button class="btn btn-primary" onclick="openVoteModal(${election.id})">
                                <i class="fas fa-vote-yea"></i> Voter
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderElections() {
            const container = document.getElementById('elections-list');
            if (!container) return;
            
            if (appState.elections.length === 0) {
                container.innerHTML = '<p style="text-align: center; margin: 2rem;">Aucune √©lection disponible.</p>';
                return;
            }

            container.innerHTML = appState.elections.map(election => {
                const positionsText = election.positions && election.positions.length > 0 ? 
                    election.positions.map(p => positions[p]).join(', ') : 'Aucun poste d√©fini';
                const candidatesCount = appState.candidates.filter(c => c.electionId === election.id).length;
                const votesCount = appState.votes.filter(v => v.electionId === election.id).length;
                
                return `
                    <div class="election-card">
                        <div class="election-info">
                            <h3>${election.title}</h3>
                            <p><strong>Postes:</strong> ${positionsText}</p>
                            <p>${election.description}</p>
                            <p>${candidatesCount} candidat(s) - ${votesCount} vote(s)</p>
                            <span class="election-status status-${election.status}">${getStatusText(election.status)}</span>
                            <div class="election-dates">
                                ${formatDate(election.startDate)} - ${formatDate(election.endDate)}
                            </div>
                        </div>
                        <div class="election-actions">
                            ${election.status === 'active' ? 
                                `<button class="btn btn-primary" onclick="openVoteModal(${election.id})">
                                    <i class="fas fa-vote-yea"></i> Voter
                                </button>` : 
                                `<button class="btn btn-secondary" disabled>
                                    ${election.status === 'draft' ? '√Ä venir' : 'Termin√©'}
                                </button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderResults() {
            const container = document.getElementById('results-content');
            if (!container) return;
            
            const activeElections = appState.elections.filter(e => e.status === 'active' || e.status === 'closed');
            
            if (activeElections.length === 0) {
                container.innerHTML = '<p style="text-align: center; margin: 2rem;">Aucun r√©sultat disponible.</p>';
                return;
            }

            container.innerHTML = activeElections.map(election => {
                const electionVotes = appState.votes.filter(v => v.electionId === election.id);
                const participationRate = appState.voters.length > 0 ? 
                    ((electionVotes.length / appState.voters.length) * 100).toFixed(1) : 0;

                return `
                    <div class="results-chart">
                        <h3>${election.title}</h3>
                        <div style="margin-bottom: 1rem;">
                            <p><strong>Votes exprim√©s:</strong> ${electionVotes.length}</p>
                            <p><strong>Taux de participation:</strong> ${participationRate}%</p>
                        </div>
                        
                        ${election.positions && election.positions.length > 0 ? 
                            election.positions.map(position => {
                                const results = calculateResults(election.id, position);
                                
                                return `
                                    <div style="margin-bottom: 2rem;">
                                        <h4>${positions[position]}</h4>
                                        ${results.length > 0 ? results.map((result, index) => `
                                            <div class="result-bar">
                                                <div class="result-header">
                                                    <span><strong>${result.name === 'Vote blanc' ? 'Vote blanc' : result.name}</strong></span>
                                                    <span>${result.percentage}% (${result.votes} votes)</span>
                                                </div>
                                                <div class="result-progress">
                                                    <div class="result-fill ${index === 0 ? 'first' : index === 1 ? 'second' : index === 2 ? 'third' : 'other'}" 
                                                         style="width: ${result.percentage}%"></div>
                                                </div>
                                            </div>
                                        `).join('') : '<p>Aucun vote pour ce poste.</p>'}
                                    </div>
                                `;
                            }).join('') : '<p>Aucun poste d√©fini pour cette √©lection.</p>'
                        }
                    </div>
                `;
            }).join('');
        }

        function renderAdmin() {
            switchAdminTab('elections');
        }

        function renderProfile() {
    if (!appState.currentUser) return;

    // Pr√©nom + nom
    const fullName = `${appState.currentUser.prenom} ${appState.currentUser.nom}`.trim();
    document.getElementById('display-name').textContent = fullName || '-';

    // Email
    document.getElementById('display-email').textContent = appState.currentUser.email || '-';

    // Matricule
    document.getElementById('display-matricule').textContent = appState.currentUser.matricule || '-';
    document.getElementById('edit-matricule').value = appState.currentUser.matricule || '';

    // Promotion
    document.getElementById('display-promotion').textContent = appState.currentUser.promotion || '-';
    document.getElementById('edit-promotion').value = appState.currentUser.promotion || '';

    // Sp√©cialit√©
    document.getElementById('display-specialite').textContent = appState.currentUser.specialite || '-';
    document.getElementById('edit-specialite').value = appState.currentUser.specialite || '';
}

        function switchAdminTab(tab) {
            document.querySelectorAll('#admin-page .btn').forEach(btn => {
                if (btn.id && btn.id.includes('-tab-btn')) {
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                }
            });
            const activeBtn = document.getElementById(tab + '-tab-btn');
            if (activeBtn) {
                activeBtn.classList.remove('btn-secondary');
                activeBtn.classList.add('btn-primary');
            }

            document.querySelectorAll('.admin-tab').forEach(tabElement => {
                tabElement.classList.remove('active');
            });

            const activeTab = document.getElementById('admin-' + tab);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            switch(tab) {
                case 'elections':
                    renderAdminElections();
                    break;
                case 'candidates':
                    renderAdminCandidates();
                    break;
                case 'voters':
                    renderAdminVoters();
                    break;
            }
        }

        function renderAdminElections() {
            const container = document.getElementById('admin-elections');
            if (!container) return;
            
            container.innerHTML = `
                <h3>Gestion des √©lections</h3>
                <div class="elections-grid">
                    ${appState.elections.map(election => {
                        const candidatesCount = appState.candidates.filter(c => c.electionId === election.id).length;
                        const votesCount = appState.votes.filter(v => v.electionId === election.id).length;
                        const positionsText = election.positions && election.positions.length > 0 ? 
                            election.positions.map(p => positions[p]).join(', ') : 'Aucun poste d√©fini';
                        
                        return `
                            <div class="election-card">
                                <div class="election-info">
                                    <h3>${election.title}</h3>
                                    <p><strong>Postes:</strong> ${positionsText}</p>
                                    <p>${candidatesCount} candidat(s) - ${votesCount} vote(s)</p>
                                    <span class="election-status status-${election.status}">${getStatusText(election.status)}</span>
                                    <div class="election-dates">
                                        ${formatDate(election.startDate)} - ${formatDate(election.endDate)}
                                    </div>
                                </div>
                                <div class="election-actions">
                                    <button class="btn btn-secondary" onclick="editElection(${election.id})">
                                        <i class="fas fa-edit"></i> Modifier
                                    </button>
                                    ${election.status === 'draft' ? `
                                        <button class="btn btn-success" onclick="activateElection(${election.id})">
                                            <i class="fas fa-play"></i> Activer
                                        </button>
                                    ` : election.status === 'active' ? `
                                        <button class="btn btn-warning" onclick="deactivateElection(${election.id})">
                                            <i class="fas fa-pause"></i> D√©sactiver
                                        </button>
                                    ` : `
                                        <button class="btn btn-success" onclick="activateElection(${election.id})">
                                            <i class="fas fa-play"></i> R√©activer
                                        </button>
                                    `}
                                    <button class="btn btn-danger" onclick="deleteElection(${election.id})">
                                        <i class="fas fa-trash"></i> Supprimer
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderAdminCandidates() {
            const container = document.getElementById('admin-candidates');
            if (!container) return;
            
            container.innerHTML = `
                <h3>Gestion des candidats</h3>
                <button class="btn btn-primary" onclick="openCandidateModal()" style="margin-bottom: 1rem;">
                    <i class="fas fa-plus"></i> Ajouter candidat
                </button>
                <div class="candidates-grid">
                    ${appState.candidates.map(candidate => {
                        const election = appState.elections.find(e => e.id === candidate.electionId);
                        const votesCount = appState.votes.filter(v => v.candidateId === candidate.id).length;
                        
                        return `
                            <div class="candidate-card">
                                <div class="candidate-header">
                                    <img src="${candidate.image}" alt="${candidate.name}" class="candidate-image" 
                                         onerror="this.src='https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face'">
                                    <div>
                                        <h4>${candidate.name}</h4>
                                        <p>${candidate.program}</p>
                                        <p><strong>√âlection:</strong> ${election ? election.title : 'N/A'}</p>
                                        <p><strong>Poste:</strong> ${positions[candidate.position]}</p>
                                        <p><strong>Votes re√ßus:</strong> ${votesCount}</p>
                                    </div>
                                </div>
                                <p>${candidate.description}</p>
                                <div style="margin-top: 1rem;">
                                    <button class="btn btn-secondary" onclick="editCandidate(${candidate.id})">
                                        <i class="fas fa-edit"></i> Modifier
                                    </button>
                                    <button class="btn btn-danger" onclick="deleteCandidate(${candidate.id})">
                                        <i class="fas fa-trash"></i> Supprimer
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderAdminVoters() {
            const container = document.getElementById('admin-voters');
            if (!container) return;
            
            const votersWhoVoted = appState.voters.filter(v => v.hasVoted && v.hasVoted.length > 0).length;
            const participationRate = appState.voters.length > 0 ? 
                ((appState.votes.length / appState.voters.length) * 100).toFixed(1) : 0;
            
            container.innerHTML = `
                <h3>Gestion des √©lecteurs</h3>
                <div style="margin-bottom: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div class="stat-card">
                        <div class="stat-icon primary">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <p class="stat-label">Total √©lecteurs</p>
                            <p class="stat-value">${appState.voters.length}</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">
                            <i class="fas fa-check"></i>
                        </div>
                        <div>
                            <p class="stat-label">Ont vot√©</p>
                            <p class="stat-value">${votersWhoVoted}</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon secondary">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div>
                            <p class="stat-label">Participation</p>
                            <p class="stat-value">${participationRate}%</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin: 1rem 0;">
                    ${appState.voters.map(voter => `
                        <div class="election-card">
                            <div class="election-info">
                                <h4>${voter.prenom || ''} ${voter.nom || ''} ${voter.name || ''}</h4>
                                <p>${voter.email} - ${voter.classe || voter.program || ''}</p>
                                <span class="election-status ${voter.hasVoted && voter.hasVoted.length > 0 ? 'status-closed' : 'status-active'}">
                                    ${voter.hasVoted && voter.hasVoted.length > 0 ? `A vot√© (${voter.hasVoted.length} √©lections)` : 'N\'a pas vot√©'}
                                </span>
                            </div>
                            <div class="election-actions">
                                <button class="btn btn-secondary" onclick="resetVoterStatus(${voter.id})" 
                                        ${!voter.hasVoted || voter.hasVoted.length === 0 ? 'disabled' : ''}>
                                    <i class="fas fa-undo"></i> Reset
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 1. Quand l‚Äô√©tudiant se connecte, on sauvegarde ses infos
        document.getElementById("login-form").addEventListener("submit", function(e) {
            e.preventDefault();

            const nom = document.getElementById("login-nom").value.trim();
            const email = document.getElementById("login-email").value.trim();

            // On enregistre les infos dans localStorage
            localStorage.setItem("studentName", nom);
            localStorage.setItem("studentEmail", email);

            // On affiche l'application principale (ex: avec .app-container)
            document.querySelector(".app-container").classList.add("active");
            document.getElementById("login-form").parentElement.style.display = "none";

            // On charge les infos dans le profil
            loadStudentProfile();
        });

        // 2. Cette fonction affiche les infos dans la section profil
        function loadStudentProfile() {
            const name = localStorage.getItem("studentName") || "-";
            const email = localStorage.getItem("studentEmail") || "-";

            document.getElementById("display-name").textContent = name;
            document.getElementById("display-email").textContent = email;
        }

        // 3. Charger automatiquement le profil si d√©j√† connect√©
        window.addEventListener("DOMContentLoaded", function () {
            if (localStorage.getItem("studentName")) {
            document.querySelector(".app-container").classList.add("active");
            loadStudentProfile();
            }
        })



        // Edit profile
        function toggleEditMode() {
        // Sauvegarde les valeurs actuelles pour pouvoir annuler
        originalProfileData = {
            matricule: document.getElementById("display-matricule").textContent,
            promotion: document.getElementById("display-promotion").textContent,
            specialite: document.getElementById("display-specialite").textContent,
            photoUrl: document.getElementById("photo-url").value
        };

        // Bascule l'affichage en mode √©dition
        document.querySelectorAll(".view-mode").forEach(el => el.style.display = "none");
        document.querySelectorAll(".edit-mode-only").forEach(el => el.style.display = "block");
    }

    function cancelEdit() {
        // Restaure les anciennes valeurs
        document.getElementById("edit-matricule").value = originalProfileData.matricule;
        document.getElementById("edit-promotion").value = originalProfileData.promotion;
        document.getElementById("edit-specialite").value = originalProfileData.specialite;
        document.getElementById("photo-url").value = originalProfileData.photoUrl;

        // Bascule l'affichage en mode lecture seule
        document.querySelectorAll(".edit-mode-only").forEach(el => el.style.display = "none");
        document.querySelectorAll(".view-mode").forEach(el => el.style.display = "block");
    }

    function saveProfile() {
        // Met √† jour l'affichage avec les nouvelles valeurs
        const matricule = document.getElementById("edit-matricule").value;
        const promotion = document.getElementById("edit-promotion").value;
        const specialite = document.getElementById("edit-specialite").value;
        const photoUrl = document.getElementById("photo-url").value;

        document.getElementById("display-matricule").textContent = matricule;
        document.getElementById("display-promotion").textContent = promotion;
        document.getElementById("display-specialite").textContent = specialite;

        if (photoUrl.trim() !== "") {
            document.getElementById("profile-photo").innerHTML = `<img src="${photoUrl}" alt="Photo de profil" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
        }

        // Bascule en mode lecture seule
        cancelEdit();
    }

        // Fonctions utilitaires
        function updateStats() {
            const uniqueVotersCount = new Set(appState.votes.map(v => v.voterId)).size;
            const totalVoters = appState.voters.length;
            const participationRate = totalVoters > 0 ? ((uniqueVotersCount / totalVoters) * 100).toFixed(1) : 0;
            const activeElections = appState.elections.filter(e => e.status === 'active').length;

            const stats = {
                'total-students': totalVoters.toLocaleString(),
                'total-votes': uniqueVotersCount.toLocaleString(),
                'participation-rate': participationRate + '%',
                'active-elections': activeElections,
                'total-students-home': totalVoters.toLocaleString(),
                'total-votes-home': uniqueVotersCount.toLocaleString(),
                'participation-rate-home': participationRate + '%',
                'active-elections-home': activeElections
            };

            Object.entries(stats).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            });
        }

        function calculateResults(electionId, position) {
            const candidates = appState.candidates.filter(c => c.electionId === electionId && c.position === position);
            const votes = appState.votes.filter(v => v.electionId === electionId && v.position === position);
            
            const results = candidates.map(candidate => {
                const candidateVotes = votes.filter(v => v.candidateId === candidate.id).length;
                const percentage = votes.length > 0 ? ((candidateVotes / votes.length) * 100).toFixed(1) : 0;
                
                return {
                    id: candidate.id,
                    name: candidate.name,
                    votes: candidateVotes,
                    percentage: parseFloat(percentage)
                };
            });

            const blankVotes = votes.filter(v => !v.candidateId || v.candidateId === 'blank').length;
            if (blankVotes > 0) {
                const blankPercentage = votes.length > 0 ? ((blankVotes / votes.length) * 100).toFixed(1) : 0;
                results.push({
                    id: 'blank',
                    name: 'Vote blanc',
                    votes: blankVotes,
                    percentage: parseFloat(blankPercentage)
                });
            }
            
            return results.sort((a, b) => b.votes - a.votes);
        }

        function getStatusText(status) {
            const statusMap = {
                'draft': 'Brouillon',
                'active': 'En cours',
                'closed': 'Termin√©e',
                'inactive': 'Inactive'
            };
            return statusMap[status] || status;
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Gestion des modals
        function openElectionModal(electionId = null) {
            if (!appState.isAdmin) {
                showToast('Acc√®s refus√©', 'Seuls les administrateurs peuvent g√©rer les √©lections', 'error');
                return;
            }

            appState.editingElection = electionId;
            
            const modalTitle = document.getElementById('election-modal-title');
            const submitBtn = document.getElementById('election-submit-btn');
            
            if (electionId) {
                modalTitle.textContent = 'Modifier l\'√©lection';
                submitBtn.textContent = 'Modifier';
                
                const election = appState.elections.find(e => e.id === electionId);
                if (election) {
                    document.getElementById('edit-election-id').value = electionId;
                    document.getElementById('election-title').value = election.title;
                    document.getElementById('election-description').value = election.description || '';
                    document.getElementById('election-start').value = new Date(election.startDate).toISOString().slice(0, 16);
                    document.getElementById('election-end').value = new Date(election.endDate).toISOString().slice(0, 16);
                    
                    document.querySelectorAll('.position-item input[type="checkbox"]').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    if (election.positions && election.positions.length > 0) {
                        election.positions.forEach(position => {
                            const checkbox = document.getElementById(`pos-${position}`);
                            if (checkbox) checkbox.checked = true;
                        });
                    }
                }
            } else {
                modalTitle.textContent = 'Cr√©er une √©lection';
                submitBtn.textContent = 'Cr√©er';
                document.getElementById('election-form').reset();
                document.getElementById('edit-election-id').value = '';
            }
            
            const modal = document.getElementById('election-modal');
            if (modal) {
                modal.classList.add('active');
            }
        }

        function openCandidateModal(candidateId = null) {
            if (!appState.isAdmin) {
                showToast('Acc√®s refus√©', 'Seuls les administrateurs peuvent g√©rer les candidats', 'error');
                return;
            }

            appState.editingCandidate = candidateId;
            
            const select = document.getElementById('candidate-election');
            if (select) {
                select.innerHTML = '<option value="">S√©lectionner une √©lection</option>' +
                    appState.elections.map(election => 
                        `<option value="${election.id}">${election.title}</option>`
                    ).join('');
            }
            
            const modalTitle = document.getElementById('candidate-modal-title');
            const submitBtn = document.getElementById('candidate-submit-btn');
            
            if (candidateId) {
                modalTitle.textContent = 'Modifier le candidat';
                submitBtn.textContent = 'Modifier';
                
                const candidate = appState.candidates.find(c => c.id === candidateId);
                if (candidate) {
                    document.getElementById('edit-candidate-id').value = candidateId;
                    document.getElementById('candidate-name').value = candidate.name;
                    document.getElementById('candidate-election').value = candidate.electionId;
                    document.getElementById('candidate-program').value = candidate.program;
                    document.getElementById('candidate-description').value = candidate.description;
                    document.getElementById('candidate-image').value = candidate.image;
                    
                    updatePositionSelect();
                    document.getElementById('candidate-position').value = candidate.position;
                    
                    const preview = document.getElementById('candidate-image-preview');
                    if (preview && candidate.image) {
                        preview.src = candidate.image;
                        preview.style.display = 'block';
                    }
                }
            } else {
                modalTitle.textContent = 'Ajouter un candidat';
                submitBtn.textContent = 'Ajouter';
                document.getElementById('candidate-form').reset();
                document.getElementById('edit-candidate-id').value = '';
                document.getElementById('candidate-image-preview').style.display = 'none';
            }
            
            const modal = document.getElementById('candidate-modal');
            if (modal) {
                modal.classList.add('active');
            }
        }

        function openVoteModal(electionId) {
            const election = appState.elections.find(e => e.id === electionId);
            
            if (!election) {
                showToast('Erreur', '√âlection introuvable', 'error');
                return;
            }

            if (election.status !== 'active') {
                showToast('Information', 'Cette √©lection n\'est pas active', 'warning');
                return;
            }

            if (appState.currentUser && appState.currentUser.hasVoted && appState.currentUser.hasVoted.includes(electionId)) {
                showToast('Information', 'Vous avez d√©j√† vot√© pour cette √©lection', 'warning');
                return;
            }

            const titleEl = document.getElementById('vote-modal-title');
            if (titleEl) {
                titleEl.textContent = election.title;
            }
            
            const content = document.getElementById('vote-modal-content');
            if (content) {
                content.innerHTML = `
                    <div style="margin-bottom: 1rem;">
                        <p>${election.description}</p>
                    </div>
                    
                    ${election.positions && election.positions.length > 0 ? 
                        election.positions.map(position => {
                            const candidates = appState.candidates.filter(c => c.electionId === electionId && c.position === position);
                            
                            return `
                                <div class="vote-section">
                                    <h4>${positions[position]}</h4>
                                    <div class="candidates-grid">
                                        ${candidates.map(candidate => `
                                            <div class="candidate-card" onclick="selectCandidate(${candidate.id}, '${position}')">
                                                <div class="candidate-header">
                                                    <input type="radio" name="vote-${position}" value="${candidate.id}">
                                                    <img src="${candidate.image}" alt="${candidate.name}" class="candidate-image"
                                                         onerror="this.src='https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face'">
                                                    <div>
                                                        <h4>${candidate.name}</h4>
                                                        <p>${candidate.program}</p>
                                                    </div>
                                                </div>
                                                <p>${candidate.description}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                    
                                    <div class="blank-vote-option" onclick="selectBlankVote('${position}')">
                                        <input type="radio" name="vote-${position}" value="blank">
                                        <i class="fas fa-times-circle" style="font-size: 2rem; color: var(--gray-400); margin-bottom: 0.5rem;"></i>
                                        <h4>Vote blanc</h4>
                                        <p>Ne pas voter pour ce poste</p>
                                    </div>
                                </div>
                            `;
                        }).join('') : '<p>Aucun poste d√©fini pour cette √©lection.</p>'
                    }
                    
                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="closeModal('vote-modal')">Annuler</button>
                        <button class="btn btn-primary" onclick="submitVote(${electionId})" id="submit-vote-btn">
                            <i class="fas fa-check"></i> Confirmer les votes
                        </button>
                    </div>
                `;
            }
            
            const modal = document.getElementById('vote-modal');
            if (modal) {
                modal.classList.add('active');
            }
        }

        function selectCandidate(candidateId, position) {
            document.querySelectorAll(`#vote-modal input[name="vote-${position}"]`).forEach(radio => {
                radio.closest('.candidate-card, .blank-vote-option').classList.remove('selected');
            });
            
            const clickedCard = event.currentTarget;
            clickedCard.classList.add('selected');
            
            document.querySelector(`input[name="vote-${position}"][value="${candidateId}"]`).checked = true;
        }

        function selectBlankVote(position) {
            document.querySelectorAll(`#vote-modal input[name="vote-${position}"]`).forEach(radio => {
                radio.closest('.candidate-card, .blank-vote-option').classList.remove('selected');
            });
            
            const clickedOption = event.currentTarget;
            clickedOption.classList.add('selected');
            
            document.querySelector(`input[name="vote-${position}"][value="blank"]`).checked = true;
        }

        function submitVote(electionId) {
            const election = appState.elections.find(e => e.id === electionId);
            if (!election) return;

            const votes = [];

            if (election.positions && election.positions.length > 0) {
                election.positions.forEach(position => {
                    const selectedCandidate = document.querySelector(`input[name="vote-${position}"]:checked`);
                    if (selectedCandidate) {
                        votes.push({
                            position: position,
                            candidateId: selectedCandidate.value === 'blank' ? null : parseInt(selectedCandidate.value)
                        });
                    }
                });
            }

            votes.forEach(vote => {
                const individualVote = {
                    id: appState.votes.length + 1,
                    electionId: electionId,
                    position: vote.position,
                    candidateId: vote.candidateId,
                    voterId: appState.currentUser.id,
                    timestamp: new Date().toISOString()
                };
                appState.votes.push(individualVote);
            });

            // Mettre √† jour le statut de vote de l'utilisateur
            if (appState.currentUser) {
                if (!appState.currentUser.hasVoted) appState.currentUser.hasVoted = [];
                appState.currentUser.hasVoted.push(electionId);
                
                // Mettre √† jour aussi dans la liste des √©lecteurs
                const voter = appState.voters.find(v => v.id === appState.currentUser.id);
                if (voter) {
                    if (!voter.hasVoted) voter.hasVoted = [];
                    voter.hasVoted.push(electionId);
                }
                
                localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
            }

            saveData();
            updateStats();
            
            closeModal('vote-modal');
            showToast('Vote enregistr√©', 'Votre vote a √©t√© pris en compte avec succ√®s', 'success');
        }

        function openImportModal() {
            if (!appState.isAdmin) {
                showToast('Acc√®s refus√©', 'Seuls les administrateurs peuvent importer des donn√©es', 'error');
                return;
            }

            const modal = document.getElementById('import-modal');
            if (modal) {
                modal.classList.add('active');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
            
            if (modalId === 'election-modal') {
                appState.editingElection = null;
            } else if (modalId === 'candidate-modal') {
                appState.editingCandidate = null;
            }
        }

        // Mise √† jour de la liste des postes dans le formulaire candidat
        function updatePositionSelect() {
            const electionSelect = document.getElementById('candidate-election');
            const positionSelect = document.getElementById('candidate-position');
            
            const selectedElectionId = parseInt(electionSelect.value);
            const election = appState.elections.find(e => e.id === selectedElectionId);
            
            if (election && election.positions) {
                positionSelect.innerHTML = '<option value="">S√©lectionner un poste</option>' +
                    election.positions.map(position => 
                        `<option value="${position}">${positions[position]}</option>`
                    ).join('');
            } else {
                positionSelect.innerHTML = '<option value="">S√©lectionner un poste</option>';
            }
        }

        // Gestion de l'upload d'images
        function handleImageUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('candidate-image-preview');
                    const imageInput = document.getElementById('candidate-image');
                    
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    imageInput.value = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        // Gestion des formulaires
        function handleElectionSubmit(e) {
            e.preventDefault();
            
            const title = document.getElementById('election-title').value;
            const description = document.getElementById('election-description').value;
            const startDate = new Date(document.getElementById('election-start').value);
            const endDate = new Date(document.getElementById('election-end').value);
            const editId = document.getElementById('edit-election-id').value;

            const selectedPositions = [];
            document.querySelectorAll('.position-item input[type="checkbox"]:checked').forEach(checkbox => {
                selectedPositions.push(checkbox.value);
            });

            if (selectedPositions.length === 0) {
                showToast('Erreur', 'Veuillez s√©lectionner au moins un poste √©lectif', 'error');
                return;
            }

            if (startDate >= endDate) {
                showToast('Erreur', 'La date de fin doit √™tre post√©rieure √† la date de d√©but', 'error');
                return;
            }

            if (editId) {
                const election = appState.elections.find(e => e.id === parseInt(editId));
                if (election) {
                    election.title = title;
                    election.positions = selectedPositions;
                    election.description = description;
                    election.startDate = startDate;
                    election.endDate = endDate;
                    
                    showToast('Succ√®s', '√âlection modifi√©e avec succ√®s', 'success');
                }
            } else {
                const election = {
                    id: Date.now(),
                    title: title,
                    positions: selectedPositions,
                    description: description,
                    startDate: startDate,
                    endDate: endDate,
                    status: 'draft'
                };

                appState.elections.push(election);
                showToast('Succ√®s', '√âlection cr√©√©e avec succ√®s', 'success');
            }

            saveData();
            updateStats();
            
            closeModal('election-modal');
            document.getElementById('election-form').reset();
            
            if (document.getElementById('admin-page').classList.contains('active')) {
                renderAdminElections();
            }
        }

        function handleCandidateSubmit(e) {
            e.preventDefault();
            
            const name = document.getElementById('candidate-name').value;
            const electionId = parseInt(document.getElementById('candidate-election').value);
            const position = document.getElementById('candidate-position').value;
            const program = document.getElementById('candidate-program').value;
            const description = document.getElementById('candidate-description').value;
            const image = document.getElementById('candidate-image').value || 
                          'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face';
            const editId = document.getElementById('edit-candidate-id').value;

            if (editId) {
                const candidate = appState.candidates.find(c => c.id === parseInt(editId));
                if (candidate) {
                    candidate.name = name;
                    candidate.electionId = electionId;
                    candidate.position = position;
                    candidate.program = program;
                    candidate.description = description;
                    candidate.image = image;
                    
                    showToast('Succ√®s', 'Candidat modifi√© avec succ√®s', 'success');
                }
            } else {
                const candidate = {
                    id: Date.now(),
                    electionId: electionId,
                    position: position,
                    name: name,
                    program: program,
                    description: description,
                    image: image
                };

                appState.candidates.push(candidate);
                showToast('Succ√®s', 'Candidat ajout√© avec succ√®s', 'success');
            }

            saveData();
            
            closeModal('candidate-modal');
            
            if (document.getElementById('admin-page').classList.contains('active')) {
                renderAdminCandidates();
            }
        }

        // Import Excel
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleFileDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processExcelFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processExcelFile(file);
            }
        }

        function processExcelFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const workbook = XLSX.read(e.target.result, { type: 'binary' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const data = XLSX.utils.sheet_to_json(firstSheet);
                    
                    const importType = document.getElementById('import-type').value;
                    
                    if (importType === 'voters') {
                        importVoters(data);
                    } else if (importType === 'candidates') {
                        importCandidates(data);
                    }
                    
                } catch (error) {
                    showToast('Erreur', 'Erreur lors de la lecture du fichier Excel', 'error');
                    console.error('Erreur import Excel:', error);
                }
            };
            reader.readAsBinaryString(file);
        }

        function importVoters(data) {
            try {
                appState.voters = [];
                
                const voters = data.map((row, index) => ({
                    id: index + 1,
                    email: (row.email || row.Email || '').toLowerCase(),
                    password: row.password || row['mot de passe'] || row.Password || '',
                    prenom: row.prenom || row.Prenom || row['Pr√©nom'] || row.firstname || '',
                    nom: row.nom || row.Nom || row.lastname || '',
                    classe: row.classe || row.Classe || row.program || row.Program || '',
                    hasVoted: []
                }));

                appState.voters = voters;
                saveData();
                updateStats();
                
                showToast('Succ√®s', `${voters.length} √©lecteurs import√©s (base mise √† jour)`, 'success');
                closeModal('import-modal');
                
                if (document.getElementById('admin-voters').classList.contains('active')) {
                    renderAdminVoters();
                }
            } catch (error) {
                showToast('Erreur', 'Format de fichier incorrect pour les √©lecteurs', 'error');
            }
        }

        function importCandidates(data) {
            try {
                const candidates = data.map((row, index) => ({
                    id: appState.candidates.length + index + 1,
                    electionId: row.electionId || appState.elections[0]?.id || 1,
                    position: row.position || row.poste || 'president',
                    name: row.nom || row.name || '',
                    program: row.programme || row.program || '',
                    description: row.description || '',
                    image: row.image || 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face'
                }));

                appState.candidates.push(...candidates);
                saveData();
                
                showToast('Succ√®s', `${candidates.length} candidats import√©s`, 'success');
                closeModal('import-modal');
                
                if (document.getElementById('admin-candidates').classList.contains('active')) {
                    renderAdminCandidates();
                }
            } catch (error) {
                showToast('Erreur', 'Format de fichier incorrect pour les candidats', 'error');
            }
        }

        function processImport() {
            const fileInput = document.getElementById('excel-file');
            if (fileInput.files.length === 0) {
                showToast('Erreur', 'Veuillez s√©lectionner un fichier', 'error');
                return;
            }
            
            processExcelFile(fileInput.files[0]);
        }

        // Export des r√©sultats
        function exportResults() {
            const data = {
                elections: appState.elections,
                candidates: appState.candidates,
                votes: appState.votes,
                voters: appState.voters.map(v => ({...v, password: undefined})), // Ne pas exporter les mots de passe
                statistics: {
                    totalVotes: appState.votes.length,
                    totalVoters: appState.voters.length,
                    participationRate: ((appState.votes.length / appState.voters.length) * 100).toFixed(1)
                },
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `resultats-elections-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Export r√©ussi', 'Les r√©sultats ont √©t√© export√©s', 'success');
        }

        // Syst√®me de notifications
        function showToast(title, message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div>
                    <strong>${title}</strong><br>
                    ${message}
                </div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // Actions CRUD pour les √©lections
        function activateElection(id) {
            const election = appState.elections.find(e => e.id === id);
            if (election) {
                election.status = 'active';
                saveData();
                renderAdminElections();
                updateStats();
                showToast('Succ√®s', '√âlection activ√©e', 'success');
            }
        }

        function deactivateElection(id) {
            const election = appState.elections.find(e => e.id === id);
            if (election) {
                election.status = 'inactive';
                saveData();
                renderAdminElections();
                updateStats();
                showToast('Succ√®s', '√âlection d√©sactiv√©e', 'success');
            }
        }

        function deleteElection(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette √©lection ?')) {
                appState.elections = appState.elections.filter(e => e.id !== id);
                appState.candidates = appState.candidates.filter(c => c.electionId !== id);
                appState.votes = appState.votes.filter(v => v.electionId !== id);
                saveData();
                updateStats();
                renderAdminElections();
                showToast('Succ√®s', '√âlection supprim√©e', 'success');
            }
        }

        function deleteCandidate(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce candidat ?')) {
                appState.candidates = appState.candidates.filter(c => c.id !== id);
                appState.votes = appState.votes.filter(v => v.candidateId !== id);
                saveData();
                renderAdminCandidates();
                showToast('Succ√®s', 'Candidat supprim√©', 'success');
            }
        }

        function resetVoterStatus(id) {
            const voter = appState.voters.find(v => v.id === id);
            if (voter) {
                voter.hasVoted = [];
                appState.votes = appState.votes.filter(v => v.voterId !== id);
                saveData();
                updateStats();
                renderAdminVoters();
                showToast('Succ√®s', 'Statut de l\'√©lecteur r√©initialis√©', 'success');
            }
        }

        function editElection(id) {
            openElectionModal(id);
        }

        function editCandidate(id) {
            openCandidateModal(id);
        }

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
